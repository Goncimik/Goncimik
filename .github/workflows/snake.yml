name: GOGO Snake Animation

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Generate custom GOGO snake SVG
        run: |
          python << 'PY'
          from math import sin, cos, pi

          W, H = 1200, 260
          CELL = 22
          SNAKE = "#c084fc"
          LETTER = "#22c55e"
          BG = "#020617"

          SPEED = 0.22
          SEGMENTS = 7

          def letter_G(x0, y0):
              pts = []
              for x in range(5):
                  pts.append((x0+x, y0))
                  pts.append((x0+x, y0+4))
              for y in range(5):
                  pts.append((x0, y0+y))
              pts += [(x0+3, y0+2), (x0+4, y0+2)]
              return pts

          def letter_O(x0, y0):
              pts = []
              for x in range(5):
                  pts.append((x0+x, y0))
                  pts.append((x0+x, y0+4))
              for y in range(5):
                  pts.append((x0, y0+y))
                  pts.append((x0+4, y0+y))
              return pts

          letters = (
              letter_G(10,3) +
              letter_O(18,3) +
              letter_G(26,3) +
              letter_O(34,3)
          )

          path = []
          for t in range(300):
              x = 2*pi*t/300
              px = 700 + 250*cos(x)
              py = 130 + 70*sin(x)
              path.append((px, py))

          def svg_rect(x,y,c):
              return f'<rect x="{x}" y="{y}" width="{CELL}" height="{CELL}" rx="4" fill="{c}"/>'

          out = []
          out.append(f'<svg width="{W}" height="{H}" viewBox="0 0 {W} {H}" xmlns="http://www.w3.org/2000/svg">')
          out.append(f'<rect width="100%" height="100%" fill="{BG}"/>')

          for x,y in letters:
              out.append(svg_rect(x*CELL, y*CELL, LETTER))

          d = "M " + " ".join(f"{x:.1f},{y:.1f}" for x,y in path)

          for i in range(SEGMENTS):
              delay = i * 0.25
              size = CELL * 0.9
              out.append(
                  f'<rect width="{size}" height="{size}" rx="4" fill="{SNAKE}" '
                  f'x="{W/2}" y="{H/2}">'
                  f'<animateMotion dur="{len(path)*SPEED:.1f}s" begin="{delay}s" '
                  f'repeatCount="indefinite" path="{d}"/>'
                  f'</rect>'
              )

          out.append('</svg>')

          with open("output/gogo-snake.svg","w") as f:
              f.write("\n".join(out))
          PY

      - name: Publish
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: output
          publish_branch: output
