name: GOGO Snake Animation

on:
  workflow_dispatch:
  schedule:
    - cron: "0 0 * * *"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Create SVG
        run: |
          mkdir -p output
          python << 'PY'
          import math

          W, H = 1200, 260
          CELL = 22
          BG = "#020617"
          LETTER = "#22c55e"
          SNAKE = "#c084fc"

          def rect(x,y,c):
              return f'<rect x="{x}" y="{y}" width="{CELL}" height="{CELL}" rx="5" fill="{c}"/>'

          letters = []
          for i in range(4):
              ox = 200 + i*150
              for x in range(5):
                  letters += [(ox+x*CELL,80),(ox+x*CELL,80+4*CELL)]
              for y in range(5):
                  letters += [(ox,80+y*CELL),(ox+4*CELL,80+y*CELL)]

          path = []
          for t in range(300):
              a = 2*math.pi*t/300
              path.append((600+300*math.cos(a),130+60*math.sin(a)))

          svg = []
          svg.append(f'<svg xmlns="http://www.w3.org/2000/svg" width="{W}" height="{H}">')
          svg.append(f'<rect width="100%" height="100%" fill="{BG}"/>')

          for x,y in letters:
              svg.append(rect(x,y,LETTER))

          d = "M " + " ".join(f"{x},{y}" for x,y in path)

          for i in range(7):
              svg.append(
                  f'<rect width="{CELL}" height="{CELL}" rx="5" fill="{SNAKE}">'
                  f'<animateMotion dur="18s" begin="{i*0.4}s" repeatCount="indefinite" path="{d}"/>'
                  f'</rect>'
              )

          svg.append("</svg>")

          open("output/gogo-snake.svg","w").write("\n".join(svg))
          PY

      - name: Publish
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: output
          publish_branch: output
